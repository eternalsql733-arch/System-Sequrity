<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã MFA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
        }
        
        h1 {
            color: #28a745;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .success-icon {
            font-size: 60px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .message {
            text-align: center;
            color: #555;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }
        
        .warning-box h3 {
            margin-top: 0;
            color: #856404;
        }
        
        .codes-container {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .codes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        @media (max-width: 500px) {
            .codes-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .code-item {
            background: white;
            padding: 12px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 16px;
            text-align: center;
            border: 1px solid #ddd;
            user-select: all;
        }
        
        .actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 14px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            text-align: center;
            text-decoration: none;
            display: block;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .instructions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #666;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            body { background: white !important; }
            .container { box-shadow: none !important; border: 1px solid #000; }
            .btn { display: none !important; }
            .warning-box { border: 2px solid #000 !important; }
            .codes-container { border: 2px solid #000 !important; }
            .code-item { border: 1px solid #000 !important; }
            .print-only { display: block; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="success-icon">‚úÖ</div>
        <h1>MFA —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!</h1>
        
        <div class="message">
            <p>–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–µ–Ω–∞ –¥–ª—è –≤–∞—à–µ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏.</p>
            <p>–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏ –∫–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</p>
        </div>
        
        <div class="warning-box">
            <h3>‚ö†Ô∏è –í–ê–ñ–ù–û: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã!</h3>
            <p>–≠—Ç–∏ –∫–æ–¥—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É, –µ—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ–ª–µ—Ñ–æ–Ω—É —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.</p>
            <p><strong>–ö–∞–∂–¥—ã–π –∫–æ–¥ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!</strong> –ü–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω.</p>
        </div>
        
        <div class="codes-container">
            <h3 style="margin-top: 0;">–í–∞—à–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã:</h3>
            <div class="codes-grid">
                {% for code in backup_codes %}
                    <div class="code-item">{{ code }}</div>
                {% endfor %}
            </div>
        </div>
        
        <div class="actions">
            <button onclick="window.print()" class="btn btn-success">
                üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∫–æ–¥—ã
            </button>
            
            <button onclick="copyAllCodes()" class="btn btn-secondary">
                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–¥—ã
            </button>
            
            <a href="{{ url_for('index') }}" class="btn btn-primary">
                –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            </a>
        </div>
        
        <div class="instructions">
            <p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ö—Ä–∞–Ω–µ–Ω–∏—é:</strong></p>
            <ol>
                <li>–†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –∫–æ–¥—ã –∏ —Ö—Ä–∞–Ω–∏—Ç–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ</li>
                <li>–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –∫–æ–¥—ã –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–º –≤–∏–¥–µ –Ω–∞ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö</li>
                <li>–ù–µ –¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–¥–∞–º–∏ –Ω–∏ —Å –∫–µ–º</li>
                <li>–ö–∞–∂–¥—ã–π –∫–æ–¥ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</li>
                <li>–í—ã –º–æ–∂–µ—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–æ–¥—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö MFA</li>
            </ol>
        </div>
        
        <div class="print-only">
            <p><strong>–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</strong> {{ current_time }}</p>
            <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> {{ current_user.username }}</p>
        </div>
    </div>
    
    <script>
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–¥–æ–≤ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyAllCodes() {
            const codeElements = document.querySelectorAll('.code-item');
            let text = '–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã MFA:\n\n';
            
            codeElements.forEach((code, index) => {
                text += `${index + 1}. ${code.textContent}\n`;
            });
            
            text += '\n–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: ' + new Date().toLocaleString();
            
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ –í—Å–µ –∫–æ–¥—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
            }).catch(err => {
                alert('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err);
            });
        }
        
        // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        let codesSaved = false;
        
        window.addEventListener('beforeunload', function(e) {
            if (!codesSaved) {
                e.preventDefault();
                e.returnValue = '–í—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã? –ï—Å–ª–∏ –Ω–µ—Ç, –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.';
                return e.returnValue;
            }
        });
        
        // –ü–æ–º–µ—á–∞–µ–º –∫–æ–¥—ã –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–µ—á–∞—Ç–∏ –∏–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        window.addEventListener('afterprint', function() {
            codesSaved = true;
            alert('‚úÖ –ö–æ–¥—ã —Ä–∞—Å–ø–µ—á–∞—Ç–∞–Ω—ã. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        });
        
        document.querySelector('button[onclick="copyAllCodes()"]').addEventListener('click', function() {
            codesSaved = true;
        });
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±—Ä–∞—É–∑–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        try {
            const codes = Array.from(document.querySelectorAll('.code-item')).map(el => el.textContent);
            localStorage.setItem('mfa_backup_codes_' + new Date().toISOString().split('T')[0], JSON.stringify(codes));
            console.log('–ö–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±—Ä–∞—É–∑–µ—Ä–∞');
        } catch (e) {
            console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–¥—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ');
        }
    </script>
</body>
</html>